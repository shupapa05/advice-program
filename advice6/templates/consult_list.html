<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ìƒë‹´ ì‹ ì²­ ë‚´ì—­</title>
  <style>
    :root{
      --teal:#22a6b3; --teal-dark:#1e90a1;
      --head:#7ed6df; --bg:#f8f9fa; --dot-pending:#fbbf24; --dot-done:#10b981;
    }
    body{font-family:'Nanum Gothic',sans-serif;max-width:1200px;margin:50px auto;padding:20px;background:var(--bg)}
    h2{display:flex;justify-content:space-between;align-items:center;margin:0 0 18px}
    .right a.btn{margin-left:8px}
    .msg{text-align:center;margin:10px 0 22px;color:#0b7285;font-weight:600}
    table{width:100%;border-collapse:collapse;background:#fff}
    th,td{padding:10px;border:1px solid #ddd;text-align:center;vertical-align:middle}
    th{background:var(--head);color:#fff}
    tr:nth-child(even){background:#f7f9fb}
    td.txt-left{text-align:left}
    .btn{padding:6px 14px;background:var(--teal);color:#fff;border:none;border-radius:6px;text-decoration:none;display:inline-block;cursor:pointer}
    .btn:hover{background:var(--teal-dark)}
    .date-form{display:flex;gap:6px;align-items:center;justify-content:center}
    .date-input{width:160px;padding:6px 8px;border:1px solid #ccc;border-radius:6px;font:inherit}
    .date-submit{padding:6px 10px;border:none;border-radius:6px;background:#6c5ce7;color:#fff;cursor:pointer}
    .date-submit:hover{background:#5a4bd6}
    .status-dot{display:inline-block;width:12px;height:12px;border-radius:50%}
    .pending{background:var(--dot-pending)}
    .done{background:var(--dot-done)}
    /* pagination */
    .pagi{display:flex;justify-content:center;gap:6px;margin:16px 0}
    .pagi button{min-width:34px;padding:6px 10px;border:1px solid #ccc;border-radius:6px;background:#fff;cursor:pointer}
    .pagi button.active{background:#111827;color:#fff;border-color:#111827}
    .pagi button[disabled]{opacity:.5;cursor:not-allowed}
  </style>
</head>
<body>
  <h2>
    <span>ğŸ“‚ ìƒë‹´ ì‹ ì²­ ë‚´ì—­</span>
    <span class="right">
      <a href="/teacher_home" class="btn">ğŸ  êµì‚¬ í™ˆ</a>
    </span>
  </h2>

  {% with messages = get_flashed_messages() %}
    {% if messages %}
      <div class="msg">
        {% for m in messages %}{{ m }}{% if not loop.last %}<br>{% endif %}{% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <table id="reqTable">
    <thead>
      <tr>
        <th>{{ 'ì‹ ì²­ì¼(ìˆ˜ì •)' if edit_date_enabled else 'ì‹ ì²­ì¼' }}</th>
        <th>í•™ë…„</th><th>ë°˜</th><th>ë²ˆí˜¸</th><th>ì´ë¦„</th>
        <th>ì£¼ì œ</th><th>ë‚´ìš©</th>
        <th style="width:70px">ìƒíƒœ</th>
        <th style="width:90px">ì‘ì„±</th>
      </tr>
    </thead>
    <tbody id="reqTbody">
      {% for r in requests %}
      <tr class="data-row"
          data-grade="{{ r.grade }}"
          data-class="{{ r.class_num }}"
          data-number="{{ r.number }}"
          data-name="{{ r.name|e }}"
          data-topic="{{ r.topic|e }}"
          data-haslog="{{ 1 if r.btn_label=='ìˆ˜ì •' else 0 }}">
        <td>
          {% if edit_date_enabled %}
          <form class="date-form" action="/teacher/update_date" method="post">
            <input type="hidden" name="id" value="{{ r.id }}" />
            <input class="date-input" type="datetime-local" name="date"
                   value="{{ r.date|replace(' ', 'T') }}" step="60" required />
            <button class="date-submit" type="submit">ìˆ˜ì •</button>
          </form>
          {% else %}
            {{ r.date }}
          {% endif %}
        </td>
        <td>{{ r.grade }}</td>
        <td>{{ r.class_num }}</td>
        <td>{{ r.number }}</td>
        <td>{{ r.name }}</td>
        <td>{{ r.topic }}</td>
        <td class="txt-left">{{ r.content }}</td>

        <!-- ìƒíƒœ: ì ë§Œ í‘œì‹œ (ì„œë²„ì—ì„œ ê¸°ë³¸ íŒì •) -->
        <td>
          {% if r.btn_label == 'ìˆ˜ì •' %}
            <span class="status-dot done" title="ì‘ì„±ë¨"></span>
          {% else %}
            <span class="status-dot pending" title="ë¯¸ì‘ì„±"></span>
          {% endif %}
        </td>

        <!-- ë²„íŠ¼: ì„œë²„ íŒì • ê°’ ì‚¬ìš© -->
        <td>
          <a class="btn" href="/write_log/{{ r.id }}">{{ r.btn_label }}</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
  <div class="pagi" id="pagi"></div>

  <script>
    // ====== ê°„ë‹¨ í˜ì´ì§€ë„¤ì´ì…˜ (8í–‰ì”©) ======
    (function(){
      const ROWS_PER_PAGE = 8;
      const tbody = document.getElementById('reqTbody');
      const rows = Array.from(tbody.querySelectorAll('tr.data-row'));
      const total = rows.length;
      const pages = Math.max(1, Math.ceil(total / ROWS_PER_PAGE));
      let cur = 1;

      const pagi = document.getElementById('pagi');
      function renderPagi(){
        pagi.innerHTML = '';
        const prev = document.createElement('button');
        prev.textContent = 'â€¹';
        prev.disabled = (cur===1);
        prev.onclick = ()=>{cur=Math.max(1,cur-1); render();};
        pagi.appendChild(prev);

        for(let i=1;i<=pages;i++){
          const b=document.createElement('button');
          b.textContent=i;
          if(i===cur) b.classList.add('active');
          b.onclick=()=>{cur=i; render();};
          pagi.appendChild(b);
        }

        const next = document.createElement('button');
        next.textContent = 'â€º';
        next.disabled = (cur===pages);
        next.onclick = ()=>{cur=Math.min(pages,cur+1); render();};
        pagi.appendChild(next);
      }

      function render(){
        rows.forEach((tr,idx)=>{
          const page = Math.floor(idx/ROWS_PER_PAGE)+1;
          tr.style.display = (page===cur)?'':'none';
        });
        renderPagi();
      }
      render();
    })();
  </script>
</body>
</html>
