<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ìƒë‹´ ì‹ ì²­ ë‚´ì—­</title>
  <style>
    body{font-family:'Nanum Gothic',sans-serif;max-width:1100px;margin:60px auto;padding:20px;background:#f7f7fb}
    h2{text-align:center;margin-bottom:18px}
    .msg{text-align:center;margin:10px 0 22px;color:#0b7285;font-weight:600}
    table{width:100%;border-collapse:collapse;background:#fff}
    th,td{padding:10px;border:1px solid #ddd;text-align:center}
    th{background:#7ed6df;color:#fff}
    tr:nth-child(even){background:#f6fafe}
    .btn{padding:6px 14px;background:#22a6b3;color:#fff;border:none;border-radius:6px;text-decoration:none;display:inline-block}
    .btn:hover{background:#1e90a1}
    .date-form{display:flex;gap:6px;align-items:center;justify-content:center}
    .date-input{width:170px;padding:6px 8px;border:1px solid #ccc;border-radius:6px;font:inherit}
    .date-submit{padding:6px 10px;border:none;border-radius:6px;background:#6c5ce7;color:#fff;cursor:pointer}
    .date-submit:hover{background:#5a4bd6}
    .badge{display:inline-block;padding:2px 8px;border-radius:10px;font-size:12px;margin-right:6px}
    .badge-wait{background:#fff3cd;color:#9c6b00;border:1px solid #ffe08a}
    .badge-done{background:#e6fcf5;color:#0b7285;border:1px solid #96f2d7}
    .pagination{margin:18px 0;display:flex;gap:6px;justify-content:center}
    .page-btn{padding:6px 10px;border:1px solid #ccc;border-radius:6px;text-decoration:none;color:#333;background:#fff}
    .page-btn.on{background:#22a6b3;color:#fff;border-color:#22a6b3}
    .toolbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}

    /* â¬‡ï¸ í•„í„° ë°°ì§€ ì˜ì—­ */
    .filters{display:flex;justify-content:space-between;align-items:center;margin:10px 0 14px}
    .filters .left{display:flex;flex-wrap:wrap;gap:6px;align-items:center}
    .filters .reset{background:#fff;border:1px solid #ccc;color:#333}
    .filters .reset:hover{background:#f1f3f5}
    .badge-info{background:#e7f5ff;color:#1864ab;border:1px solid #a5d8ff}
    .badge-range{background:#f8f9fa;color:#495057;border:1px solid #dee2e6}
  </style>
</head>
<body>
  <div class="toolbar">
    <h2>ğŸ“‚ ìƒë‹´ ì‹ ì²­ ë‚´ì—­</h2>
    <a href="/teacher_home" class="btn">ğŸ  êµì‚¬ í™ˆ</a>
  </div>

  {% with messages = get_flashed_messages() %}
    {% if messages %}
      <div class="msg">
        {% for m in messages %}{{ m }}{% if not loop.last %}<br>{% endif %}{% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  {# ===== í™œì„± í•„í„° ë°°ì§€ í‘œì‹œ / ì´ˆê¸°í™” ë²„íŠ¼ ===== #}
  {% set q_number = request.args.get('number') %}
  {% set q_name   = request.args.get('name') %}
  {% set q_topic  = request.args.get('topic') %}
  {% set q_from   = request.args.get('from') %}
  {% set q_to     = request.args.get('to') %}
  {% set has_filters = q_number or q_name or q_topic or q_from or q_to %}
  <div class="filters">
    <div class="left">
      {% if has_filters %}
        <span style="font-weight:600;">ì ìš©ëœ í•„í„°:</span>
        {% if q_number %}<span class="badge badge-info">ë²ˆí˜¸ {{ q_number }}</span>{% endif %}
        {% if q_name   %}<span class="badge badge-info">ì´ë¦„ {{ q_name }}</span>{% endif %}
        {% if q_topic  %}<span class="badge" style="background:#e6fcf5;color:#087f5b;border:1px solid #96f2d7">ì£¼ì œ {{ q_topic }}</span>{% endif %}
        {% if q_from   %}<span class="badge badge-range">ì‹œì‘ {{ q_from }}</span>{% endif %}
        {% if q_to     %}<span class="badge badge-range">ì¢…ë£Œ {{ q_to }}</span>{% endif %}
      {% else %}
        <span class="badge badge-range">í•„í„° ì—†ìŒ (ë‹´ì„ ë°˜ ì „ì²´)</span>
      {% endif %}
    </div>
    <div class="right">
      {% if has_filters %}
        <a class="btn reset" href="{{ url_for('consult_list') }}">í•„í„° ì´ˆê¸°í™”</a>
      {% endif %}
    </div>
  </div>

  <table>
    <thead>
      <tr>
        <th>{{ 'ì‹ ì²­ì¼(ìˆ˜ì •)' if edit_date_enabled else 'ì‹ ì²­ì¼' }}</th>
        <th>í•™ë…„</th><th>ë°˜</th><th>ë²ˆí˜¸</th><th>ì´ë¦„</th>
        <th>ì£¼ì œ</th><th>ë‚´ìš©</th><th>ìƒíƒœ</th><th>ì‘ì„±</th>
      </tr>
    </thead>
    <tbody>
      {% for r in requests %}
      <tr>
        <td>
          {% if edit_date_enabled %}
          <form class="date-form" action="/teacher/update_date" method="post">
            <input type="hidden" name="id" value="{{ r.id }}" />
            <input type="hidden" name="page" value="{{ page }}" />
            <input class="date-input" type="datetime-local" name="date"
                   value="{{ r.date|replace(' ', 'T') }}" step="60" required />
            <button class="date-submit" type="submit">ìˆ˜ì •</button>
          </form>
          {% else %}
            {{ r.date }}
          {% endif %}
        </td>
        <td>{{ r.grade }}</td>
        <td>{{ r.class_num }}</td>
        <td>{{ r.number }}</td>
        <td>{{ r.name }}</td>
        <td>{{ r.topic }}</td>
        <td style="text-align:left">{{ r.content }}</td>
        <td>
          {% if r.has_log %}
            <span class="badge badge-done">âœ… ì™„ë£Œ</span>
          {% else %}
            <span class="badge badge-wait">ğŸŸ¡ ëŒ€ê¸°</span>
          {% endif %}
        </td>
        <td>
          <a class="btn" href="{{ url_for('write_log', req_id=r.id, page=page) }}">{{ r.btn_label }}</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <div class="pagination">
    {% for p in range(1, page_count + 1) %}
      {% if p == page %}
        <span class="page-btn on">{{ p }}</span>
      {% else %}
        {# í˜ì´ì§€ë„¤ì´ì…˜ í´ë¦­ ë•Œë„ í˜„ì¬ í•„í„° ìœ ì§€(ì§ì ‘ ì¿¼ë¦¬ìŠ¤íŠ¸ë§ êµ¬ì„±: 'from' í‚¤ì›Œë“œ ì´ìŠˆ íšŒí”¼) #}
        <a class="page-btn"
           href="{{ url_for('consult_list') }}?page={{ p }}{% if request.args.get('per_page') %}&per_page={{ request.args.get('per_page') }}{% endif %}{% if q_number %}&number={{ q_number }}{% endif %}{% if q_name %}&name={{ q_name|urlencode }}{% endif %}{% if q_topic %}&topic={{ q_topic|urlencode }}{% endif %}{% if q_from %}&from={{ q_from|urlencode }}{% endif %}{% if q_to %}&to={{ q_to|urlencode }}{% endif %}">
          {{ p }}
        </a>
      {% endif %}
    {% endfor %}
  </div>
</body>
</html>
