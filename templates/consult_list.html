<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>상담 신청 내역</title>
  <style>
    body {
      font-family: 'Nanum Gothic', sans-serif;
      max-width: 1000px;
      margin: 60px auto;
      padding: 20px;
      background-color: #f8f9fa;
    }
    h2 { text-align: center; margin-bottom: 18px; }
    .msg { text-align:center; margin:10px 0 22px; color:#0b7285; font-weight:600; }
    table { width: 100%; border-collapse: collapse; background-color: white; }
    th, td { padding: 10px; border: 1px solid #ddd; text-align: center; }
    th { background-color: #7ed6df; color: white; }
    tr:nth-child(even) { background-color: #f2f2f2; }
    .btn {
      padding: 6px 14px; background-color: #22a6b3; color: white;
      border: none; border-radius: 6px; text-decoration: none; display:inline-block;
    }
    .btn:hover { background-color: #1e90a1; }
    .date-form { display:flex; gap:6px; align-items:center; justify-content:center; }
    .date-input {
      width: 150px; padding:6px 8px; border:1px solid #ccc; border-radius:6px;
      font-family: inherit; font-size: 14px;
    }
    .date-submit {
      padding: 6px 10px; border:none; border-radius:6px; background:#6c5ce7; color:#fff; cursor:pointer;
    }
    .date-submit:hover { background:#5a4bd6; }
    .sub { color:#666; font-size:12px; margin-top:4px; }
  </style>
</head>
<body>
  <h2>📂 상담 신청 내역</h2>

  <!-- flash 메시지 표시 -->
  {% with messages = get_flashed_messages() %}
    {% if messages %}
      <div class="msg">
        {% for m in messages %}{{ m }}{% if not loop.last %}<br>{% endif %}{% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <table>
    <thead>
      <tr>
        <th>{{ '신청일(수정)' if edit_date_enabled else '신청일' }}</th>
        <th>학년</th>
        <th>반</th>
        <th>번호</th>
        <th>이름</th>
        <th>주제</th>
        <th>내용</th>
        <th>상태</th>
        <th>작성</th>
      </tr>
    </thead>
    <tbody>
      {% for r in requests %}
      <tr>
        <!-- 날짜 수정 폼 -->
       <td>
  {% if edit_date_enabled %}
    <form class="date-form" action="/teacher/update_date" method="post">
      <input type="hidden" name="id" value="{{ r.id }}">
      <input class="date-input" type="datetime-local" name="date"
             value="{{ r.date|replace(' ', 'T') }}" step="60" required>
      <button class="date-submit" type="submit">수정</button>
    </form>
    <!-- 필요하면 안내문 유지 -->
    <!-- <div class="sub">형식: YYYY-MM-DD HH:MM</div> -->
  {% else %}
    {{ r.date }}
  {% endif %}
</td>

        <td>{{ r.grade }}</td>
        <td>{{ r.class_num }}</td>
        <td>{{ r.number }}</td>
        <td>{{ r.name }}</td>
        <td>{{ r.topic }}</td>
        <td style="text-align:left">{{ r.content }}</td>
        <td>{{ r.checked }}</td>
        <td><a class="btn" href="/write_log/{{ r.id }}">{{ r.btn_label }}</a></td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <div style="text-align: center; margin-top: 24px;">
    <a href="/teacher_home" class="btn">🏠 교사 홈으로 돌아가기</a>
  </div>
</body>
</html>
